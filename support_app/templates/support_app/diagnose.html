{% extends 'support_app/base.html' %}
{% load static %}

{% block content %}

<div class="page">

  <header>
    <div class="brand">
      <div class="logo"></div>
      <div>
        <div class="title">Expert Diagnosis</div>
        <div class="subtitle">Device metrics + AI-driven diagnosis</div>
      </div>
    </div>
  </header>

  <!-- form card -->
  <section class="card">
    <h2>Run a Diagnosis</h2>

    <form id="diagForm" class="form-grid" method="post" action="{% url 'support_app:diagnose' %}">
      {% csrf_token %}

      <!-- Auto-fill Django fields into the same grid structure -->
      <div class="field">{{ form.ping_latency.label_tag }} {{ form.ping_latency }}</div>
      <div class="field">{{ form.speed_mbps.label_tag }} {{ form.speed_mbps }}</div>
      <div class="field">{{ form.wifi_connected.label_tag }} {{ form.wifi_connected }}</div>

      <div class="field">{{ form.ping_ip.label_tag }} {{ form.ping_ip }}</div>
      <div class="field">{{ form.ping_domain.label_tag }} {{ form.ping_domain }}</div>
      <div class="field">{{ form.gateway_ping.label_tag }} {{ form.gateway_ping }}</div>

      <div class="field">{{ form.packet_loss.label_tag }} {{ form.packet_loss }}</div>
      <div class="field">{{ form.rssi.label_tag }} {{ form.rssi }}</div>

      <div class="field">{{ form.cpu_temp.label_tag }} {{ form.cpu_temp }}</div>
      <div class="field">{{ form.idle_cpu.label_tag }} {{ form.idle_cpu }}</div>

      <div class="field">{{ form.popups.label_tag }} {{ form.popups }}</div>
      <div class="field">{{ form.disk_health.label_tag }} {{ form.disk_health }}</div>

      <div class="field">{{ form.app_crash.label_tag }} {{ form.app_crash }}</div>
      <div class="field">{{ form.ram_usage.label_tag }} {{ form.ram_usage }}</div>

      <div class="advanced">
        <label>Advanced (JSON Input)</label>
        {{ form.structured }}
      </div>

      <div class="actions">
        <button id="runBtn" class="btn btn-gold" type="submit">
          <span>Run Diagnosis</span>
          <span id="runSpin" class="spinner" style="display:none"></span>
        </button>

        <button id="exampleBtn" type="button" class="btn btn-ghost">Load Example</button>

        <div style="margin-left:auto;align-self:center" class="small muted">Results will appear below</div>
      </div>

    </form>
  </section>

  <!-- results -->
  <section id="resultsCard" class="card" style="display:none">
    <h2>Diagnosis Results</h2>
    <div id="results" class="results"></div>
  </section>

</div>
{% endblock %}
